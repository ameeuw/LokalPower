
{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}



<div class="wrapper">
	{% block sidebar %}

		<div class="sidebar" data-color="purple" data-image="../assets/img/sidebar-1.jpg">

			<div class="logo">
				<a href="" class="simple-text">
					Lokal Power
				</a>
			</div>

				<div class="sidebar-wrapper">
					<ul class="nav">
						<li>
							<a href="{{ url_for('home') }}">
								<i class="material-icons">dashboard</i>
								<p>Übersicht</p>
							</a>
						</li>

						<li>
							<a href="{{ url_for('osmaps', type='sources') }}">
								<i class="material-icons">location_on</i>
								<p>Verbrauch: Karte</p>
							</a>
						</li>
						<li>
							<a href="{{ url_for('osmaps', type='sinks') }}">
								<i class="material-icons">location_off</i>
								<p>Produktion: Karte</p>
							</a>
						</li>
						<li >
							<a href="{{ url_for('details', type='sources') }}">
								<i class="fa fa-share-alt" aria-hidden="true"></i>
								<p>Verbrauch: Details</p>
							</a>
						</li>
						<li >
							<a href="{{ url_for('details', type='sinks') }}">
								<i class="fa fa-share-alt" aria-hidden="true"></i>
								<p>Produktion: Details</p>
							</a>
						</li>

						<li class="active">
							<a href="{{ url_for('batterySim') }}">
								<i class="fa fa-battery-half" aria-hidden="true"></i>
								<p>PV-Batteriesimulator</p>
							</a>
						</li>
					</ul>
				</div>
			</div>

	{% endblock %}

	<div class="main-panel">
		<div class="content">
		{% block body %}
			<div class="container-fluid">
				<div class="row embed-responsive embed-responsive-16by9" style="">

					<div class="col-md-8 embed-responsive-item" style="width: 65%;">
						<div class="well">
							<div class="" id="overview_chart" style=""></div>
						</div>
					</div>

					<div class="col-md-4 embed-responsive-item" style="left: 65%; max-width: 35%; max-height: 65%">
						<div class="row" style="height: 50%">
							<div class="col-md-12" style="height: 100%">
								<div class="well" style="height: 100%">
									<div id="pie_chart" style="height: 100%;"></div>
								</div>
							</div>
						</div>

						<div class="row" style="height: 48%;">
							<div class="col-md-12" style="height: 100%; top: 5%">
								<div class="well" style="height: 100%;">
									<form role="form" method="post" action="{{ url_for('batterySim') }}">
										<button name="BatteryCapacity" value="4">Batterie S : 9.000,- CHF</button><br><br>
										<button name="BatteryCapacity" value="8">Batterie M : 14.500,- CHF</button><br><br>
										<button name="BatteryCapacity" value="12">Batterie L : 20.000,- CHF</button><br><br>
										<button name="BatteryCapacity" value="16">Batterie XL : 25.000,- CHF</button><br><br>
									</form>
									<!--<center><h3>Wählen Sie Ihre Batteriegrösse</h3></center>
									<br>
									<form role="form" method="post" action="{{ url_for('batterySim') }}">
										<input type="range" min="0" max="30" value="{{ BatterySize }}" name="BatteryCapacity" id="BatteryCapacity"
										step="1" onchange="showValue(this.value)" />

										<span id="range"><h3>{{ BatterySize }} kWh</h3></span>
										<script type="text/javascript">

										function showValue(newValue)
										{
											document.getElementById("range").innerHTML = "<h3>" + newValue + " kWh</h3>";
										}
										</script>
										<input type="submit" class="btn btn-primary" value="Submit" />
									</form>-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% endblock %}
	</div>
</div>

	</div>
</div>



{% block footer %}

<!--
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
-->

 <script type="text/javascript">
	
var grid_to_load = {{ user.battery_simulation['annual_G2L'] |safe }};
var solar_to_load = {{ user.battery_simulation['annual_PV2L'] |safe }};
var battery_to_load = {{ user.battery_simulation['annual_B2L'] |safe }};

var monthly_pv2l = {{ user.battery_simulation['monthly_pv2l'] |safe }};
var monthly_pv = {{ user.battery_simulation['monthly_pv'] |safe }};
var monthly_b2l = {{ user.battery_simulation['monthly_b2l'] |safe }};
var monthly_demand = {{ user.demandByMonth |safe }};


Highcharts.chart('pie_chart', {
    chart: {
    	backgroundColor: '#F5F5F5',
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Deckungsgrad Ihres Verbrauchs'
    },

	subtitle: {
		text: '100 % = {{ user.period['sum_consumption'] }} kWh'
	},
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: false,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            },
        showInLegend: true,
        }
    },

	series: [{
		name: 'Anteil',
		colorByPoint: true,
		size: '100%',
		innerSize: '60%',
		data: [
			{
				name: 'Solar (direkt)',
				color: '#08BB1E',
				y: solar_to_load
			},
			{
				name: 'Batterie',
				color: '#038D14',
				y: battery_to_load,
				sliced: true
			},
			{
				name: 'Netz',
				color: '#078C92',
				y: grid_to_load
			}
		]
	}],
	legend: {
		layout: 'vertical',
		align: 'right',
		verticalAlign: 'bottom',
		labelFormatter: function() {
			return this.name + "(" + this.percentage.toFixed(1) + " %)";
		}
	}
});


Highcharts.chart('overview_chart', {
		chart: {
			backgroundColor: '#F5F5F5'
		},

		title: {
			text: 'Simulation'
		},

		subtitle: {
			text: ''
		},

		yAxis: {
			title: {
				text: 'kWh'
			}
		},

		xAxis: {
			crosshair: true
		},

		tooltip: {
			headerFormat: '<span style="font-size:14px">{{ user.period['resolution'] | replace("daily", "Tag") | replace("monthly", "Monat") }}: {point.key}</span><br><table>',
			pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
				'<td style="padding:0"><b>{point.y:.2f} kWh</b></td></tr>',
			footerFormat: '</table>',
			shared: true,
			useHTML: true
		},

		series: [

		{
			type: 'spline',
			stacking: false,
			name: 'Produktion',
			colorByPoint: false,
			color: '#FFA960',
			data: monthly_pv,
			showInLegend: true
		},

		{
			type: 'spline',
			stacking: false,
			name: 'Verbrauch',
			colorByPoint: false,
			color: '#FF6860',
			data: monthly_demand,
			showInLegend: true
		},

		{
			type: 'areaspline',
			stacking: true,
			name: 'Batterie',
			colorByPoint: false,
			color: '#038D14',
			data: monthly_b2l,
			showInLegend: true
		},

		{
			type: 'areaspline',
			fillOpacity: 0.5,
			stacking: true,
			name: 'Eigenverbrauch',
			colorByPoint: false,
			color: '#08BB1E',
			data: monthly_pv2l,
			showInLegend: true
		}

		]


		});






    </script>

	
	{% endblock %}


