
{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

<div class="wrapper">
	{% block sidebar %}

		<div class="sidebar" data-color="purple" data-image="../assets/img/sidebar-1.jpg">
			<!--
				Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

				Tip 2: you can also add an image using data-image tag
			-->

			<div class="logo">
				<a href="" class="simple-text">
					Lokal Power
				</a>
			</div>

				<div class="sidebar-wrapper">
					<ul class="nav">
						<li>
							<a href="{{ url_for('home') }}">
								<i class="material-icons">dashboard</i>
								<p>Ãœbersicht</p>
							</a>
						</li>

						<li>
							<a href="{{ url_for('osmaps') }}">
								<i class="material-icons">location_on</i>
								<p>Verbrauch: Karte</p>
							</a>
						</li>

						<li class="active">
							<a href="{{ url_for('details') }}">
								<i class="fa fa-share-alt" aria-hidden="true"></i>
								<p>Verbrauch: Details</p>
							</a>
						</li>

						<li>
							<a href="{{ url_for('batterySim') }}">
								<i class="fa fa-battery-half" aria-hidden="true"></i>
								<p>PV-Batteriesimulator</p>
							</a>
						</li>
					</ul>
				</div>
			</div>

	{% endblock %}

	<div class="main-panel">

			{% block body %}
				<div id="bar_chart" style="margin-left: 1%; float: left;  min-width: 78%; height: 60%;"></div>
				<div id="pie_chart" style="margin-right: 1%; float: right; min-width: 18%; height: 30%"></div>
				<div id="sup_table" style="margin-right: 1%; float: right; min-width: 18%; height: 30%;">
					<table class="table">
						  <tr>
							<th>Lieferant</th>
							<th>Anteil</th>
						  </tr>
						  {% for k in kWh_SharesBySource %}
						  <tr>
							  {% if producerNames[loop.index0] != user.index %}
								<td>{{ descriptions[producerNames[loop.index0]]['name'] }}</td>
							  {% else %}
								<td><b>{{ descriptions[producerNames[loop.index0]]['name'] }}</b> (Sie)</td>
							  {% endif %}
							<td> {{k * 100}} %</td>
						  </tr>
						  {% endfor %}
					</table>
				</div>
			{% endblock %}
	</div>
</div>


	{% block footer %}
	<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
	<script>

	Highcharts.chart('pie_chart', {
		chart: {
			plotBackgroundColor: null,
			plotBorderWidth: null,
			plotShadow: false,
			type: 'pie'
		},
		title: {
			text: 'Anteile der LokalPower Supplier:'
		},
		tooltip: {
			pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		},
		plotOptions: {
			pie: {
				allowPointSelect: true,
				cursor: 'pointer',
				dataLabels: {
					enabled: false,
					name: 'Anteile',
					format: '<b>{point.name}</b>: {point.percentage:.1f} %',
					style: {
						color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
					}
				}
			}
		},
		series: [{
			name: 'Shares by Source',
			colorByPoint: true,
			data: [
					{% for k in kWh_SharesBySource %}
					{
						name: '{{ descriptions[producerNames[loop.index0]]['name'] }}',
						y: {{k}}
					},
					{% endfor %}
			]
		}]
	});


	Highcharts.chart('bar_chart', {

    title: {
    	{% if user.annualProduction > 0 %}
        	text: 'Verbrauch (Quellen)'
        {% else %}
        	text: 'Verbrauch'
        {% endif %}
    },

    subtitle: {
        text: ''
    },

	{% if user.resolution == 'monthly' %}
    plotOptions: {
    	series: {
    		cursor: 'pointer',
    		point: {
    			events: {
    				click: function() {
    					//alert('Month: ' + this.category);
    					location.href='/getMonthlyGraph/' + this.category;
    				}
    			}
    		}
    	}
    },
    {% endif %}


    yAxis: {
        title: {
            text: 'kWh'
        }
    },

    xAxis: {
    	{% if user.resolution == 'daily' %}
    	categories: {{ user.period['categories'] }},
    	{% else %}
        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        {% endif %}
        crosshair: true
    },

    tooltip: {
        headerFormat: '<span style="font-size:14px">Monat: {point.key}</span><br><table>',
        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
            '<td style="padding:0"><b>{point.y:.2f} kWh</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true
    },

    series: [

    {% if user.annualProduction > 0 %}
    {% endif %}

    {% for supplierId, data in user.period['detailConnections'].iteritems() %}
		{
			type: 'column',
			stacking: true,
			name: '{{ descriptions[supplierId]['name'] }}',
			colorByPoint: false,
			data: {{ data|safe }},
			showInLegend: false
		},
	{% endfor %}
    ]


	});




	</script>
	{% endblock %}
